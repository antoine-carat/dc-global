<!DOCTYPE html>
<html>
<head>
  <meta charset='utf-8'>
  <meta http-equiv='X-UA-Compatible' content='IE=edge'>
  <title>DC Global - A Hack4Stack project</title>
  <meta name='viewport' content='width=device-width, initial-scale=1'>
  <link rel="stylesheet" href="main.css">
  <script src="vue.js"></script>
  <script src="https://unpkg.com/axios/dist/axios.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/d3/3.5.3/d3.min.js"></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/topojson/1.6.9/topojson.min.js"></script>
  <script src="datamaps.world.js"></script>
  <link href='https://fonts.googleapis.com/css?family=Orbitron' rel='stylesheet' type='text/css'>
</head>
<body>
    <div id="sidebar">
        <div id="sidebar_content">
            <h1><a href="/">DC Global</a></h1>
            <div id="icon">
                <svg width="100" height="100">
                    <defs>
                        <pattern id="image" patternUnits="userSpaceOnUse" height="100" width="100">
                            <image x="0" y="0" height="100" width="100" xlink:href="40922-1-1.jpg"></image>
                        </pattern>
                    </defs>
                    <circle id='top' cx="50" cy="50" r="50" fill="url(#image)"/>
                </svg>
            </div>
            <div>
                <div id="datacenter"></div>
                <div id="country"></div>
            </div>
        </div>
    </div>
    <div id="main">
        <div onclick="closeSidebar()" id="app" class="container">
            <div id="worldmap"></div>
        </div>
    </div>
</body>
<script>
 var sidebar = false; // sidebar = true if sidebar is open
 var bubbleclicked = false; // true if a sidebar has just been clicked

 function openSidebar(data) {
   document.getElementById("sidebar").style.marginLeft = "0px";
   updateSidebar(data);
	 sidebar = true;
   console.log("open sidebar");
 }

 function closeSidebar() {
   if (bubbleclicked == false) {
     document.getElementById("sidebar").style.marginLeft = "-400px";
	   sidebar = false;
     console.log("close sidebar");
   };
   bubbleclicked = false;
 }

 function updateSidebar(data) {
   datacenter = data.id
   document.getElementById("datacenter").innerHTML = data.id
   document.getElementById("country").innerHTML = data.country

 };

 var app = new Vue({
   el: '#app',
   data: {
     currentTime: "0:00:00",
     datacenters: []
   },
   mounted() {
    this.startTime()
    axios.get('/datacenters')
      .then( response => {
        this.datacenters = response.data
        var map = new Datamap({
          element: document.getElementById('worldmap'),
          fills: {
            HIGH: 'orange',
            LABEL: 'green',
            defaultFill: 'slategray'
          },
          data: {
            IRL: { fillKey: 'HIGH' },
            USA: { fillKey: 'HIGH' },
            AUS: { fillKey: 'HIGH' },
            IND: { fillKey: 'HIGH' },
            DEU: { fillKey: 'HIGH' }
          },
        });

        // var dcguys = [{
        //   name: 'Steve Kearns',
        //   fillKey: 'LABEL',
        //   dc_id: '123456',
        //   work_hours: '9-5pm',
        //   image: "40922-1-1.jpg"
        // }];
          
        // let datacenters = [{
        //   radius: 20,
        //   id: "123456",
        //   city: "Dublin",
        //   country: "Ireland",
        //   latitude: 53.3498,
        //   longitude: -6.2603,
        //   fillKey: 'LABEL'
        // },
        // {
        //   radius: 20,
        //   id: "123456",
        //   city: "Atlanta",
        //   country: "USA",
        //   latitude: 33.7490,
        //   longitude: -84.3880,
        //   fillKey: 'LABEL'
        // }]

        // Draw bubbles
        const DCS = this.datacenters.map( e => {
          return {
            ...e,
            radius: 20,
            fillKey: 'LABEL'
          }
        })
        map.bubbles(DCS, { popupTemplate: function (geo, data) {
          return ['<div class="hoverinfo">' +  data.name,
          '<br/>City: ' +  data.id,
          '<br/>Country: ' +  data.country + '',
          '<br/>Date: ' +  data.date + '',
          '</div>'].join('');
        }});
      })
      .catch( error => {
        console.error(error)
      });
   },
   methods: {
    startTime: function () {
      var today = new Date();
      var h = today.getHours();
      var m = today.getMinutes();
      var s = today.getSeconds();
      m = this.checkTime(m);
      s = this.checkTime(s);
      this.currentTime = h + ":" + m + ":" + s;
      var t = setTimeout(this.startTime, 500);
    },
    checkTime: function (i) {
      if (i < 10) {i = "0" + i};  // add zero in front of numbers < 10
      return i;
    }
   }
 })
</script>
</html>
